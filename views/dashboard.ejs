<div class="container-fluid">
    <div class="row">
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-3">
            <div class="card">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="text-sm mb-0 text-capitalize font-weight-bold">Today</p>
                                <h5 class="font-weight-bolder mb-0" id="today-section">
                                    <!-- <span class="text-success text-sm font-weight-bolder">+55%</span> -->
                                </h5>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-3">
            <div class="card">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="text-sm mb-0 text-capitalize font-weight-bold">양품</p>
                                <h5 class="font-weight-bolder mb-0">
                                    <%= (prodData.length - (defectsData.length > 0  ? defectsData[0].distinct_module_count : 0)) %>
                                        <!-- <span class="text-success text-sm font-weight-bolder">+3%</span> -->
                                </h5>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                <i class="ni ni-world text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6 mb-xl-0 mb-3">
            <div class="card">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="text-sm mb-0 text-capitalize font-weight-bold">불량품</p>
                                <h5 class="font-weight-bolder mb-0">
                                    <%= defectsData.length > 0  ? defectsData[0].distinct_module_count : 0 %>
                                        <!-- <span class="text-danger text-sm font-weight-bolder">-2%</span> -->
                                </h5>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                <i class="ni ni-paper-diploma text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-sm-6">
            <div class="card">
                <div class="card-body p-3">
                    <div class="row">
                        <div class="col-8">
                            <div class="numbers">
                                <p class="text-sm mb-0 text-capitalize font-weight-bold">총 생산량</p>
                                <h5 class="font-weight-bolder mb-0">
                                    <%= prodData.length %>
                                        <!-- <span class="text-success text-sm font-weight-bolder">+5%</span> -->
                                </h5>
                            </div>
                        </div>
                        <div class="col-4 text-end">
                            <div class="icon icon-shape bg-gradient-primary shadow text-center border-radius-md">
                                <i class="ni ni-cart text-lg opacity-10" aria-hidden="true"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-lg-6 mb-lg-0 mb-3">
            <div class="card h-100">
                <div class="card-header pb-0">
                    <h5>실시간 공정</h5>
                </div>
                <div class="card-body"
                    style="padding-top: 0rem !important; padding-bottom: 0rem !important; padding-left: 0.5rem !important; padding-right: 0.5rem !important">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="d-flex flex-column h-100" style=" margin-bottom: 0.5rem;">
                                <div class="process_status">
                                    <img src="/image/new_view.png" class="img process_default_img"></img>
                                    <div class='process_unit process_unit_1'>
                                        <img src="/image/work_cell_2.png"></img>
                                    </div>
                                    <% for(var i=2; i<7; i++){ %>
                                        <div class='<%="process_unit process_unit_"+i %>'
                                            id='<%="process_unit process_unit_"+i %>'>
                                            <img src="/image/new_work_4.png" id='process_work_image'></img>
                                        </div>
                                        <%} %>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 mb-lg-0  mb-3">
            <div class="card h-100">
                <div class="card-header pb-0">
                    <h5>공정 현황</h5>
                </div>

                <div class="card-body ps-5 py-3 ">
                    <section>
                        <ul class="timeline-with-icons">
                            <!-- <li class="timeline-item mb-3">
                                <span class="timeline-icon process-icon-1">
                                    <i class="fas fa-rocket text-primary fa-sm fa-fw"></i>
                                </span>
                                <h6 class="fw-bold">Cell 도착</h6>
                                <p class="text-muted">
                                    Cell 도착 상태
                                </p>
                            </li> -->

                            <li class="timeline-item mb-3">
                                <span class="timeline-icon" id="process_packaging">
                                    <i class="fas fa-rocket fa-sm fa-fw" id="process_packaging_i"></i>
                                </span>
                                <h6 class="fw-bold" id="process_packaging_h6">패키징 공정</h6>
                                <h5 class="fw-bold" id="process_packaging_h5" style="display: none;">패키징 공정</h5>
                                <p class="text-muted">
                                    Cell을 케이스에 담는 과정
                                </p>
                            </li>

                            <li class="timeline-item mb-3">
                                <span class="timeline-icon" id="process_welding">
                                    <i class="fas fa-hand-holding-usd fa-sm fa-fw" id="process_welding_i"></i>
                                </span>
                                <h6 class="fw-bold" id="process_welding_h6">용접 공정</h6>
                                <h5 class="fw-bold" id="process_welding_h5" style="display: none;">용접 공정</h5>
                                <p class="text-muted">
                                    케이스 용접 과정
                                </p>
                            </li>

                            <li class="timeline-item  mb-3">
                                <span class="timeline-icon" id="process_inspection">
                                    <i class="fas fa-users fa-sm fa-fw" id="process_inspection_i"></i>
                                </span>
                                <h6 class="fw-bold" id="process_inspection_h6">검사 공정</h6>
                                <h5 class="fw-bold" id="process_inspection_h5" style="display: none;">검사 공정</h5>
                                <p class="text-muted">
                                    용접 불량 및 기타 검사 과정
                                </p>
                            </li>

                            <li class="timeline-item mb-3">
                                <span class="timeline-icon process-icon-5" id="process_loading">
                                    <i class="fas fa-money-bill-wave fa-sm fa-fw" id="process_loading_i"></i>
                                </span>
                                <h6 class="fw-bold" id="process_loading_h6">적재 공정</h6>
                                <h5 class="fw-bold" id="process_loading_h5" style="display: none;">적재 공정</h5>
                                <p class="text-muted">
                                    완성된 모듈을 창고에 적재 하는 과정
                                </p>
                            </li>
                        </ul>
                    </section>
                </div>
            </div>
        </div>
        <div class="col-lg-3 ">
            <div class="card h-100">
                <div class="card-header pb-0">
                    <div class="row">
                        <div class="col-lg-6 col-7">
                            <h5>불량 내역</h5>
                        </div>
                        <div class="col-lg-6 col-5 my-auto text-end"><span style="cursor: pointer;"
                                onclick="location.href='/production/defects'">자세히</span></div>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="table-responsive p-0 no_scroll">
                        <table class="table align-items-center mb-0  ">
                            <thead>
                                <tr>
                                    <th class="text-uppercase text-secondary font-weight-bolder opacity-7">모듈
                                        번호</th>
                                    <th class="text-center text-uppercase text-secondary  font-weight-bolder opacity-7">
                                        불량 유형</th>
                                    <th class="text-center text-uppercase text-secondary font-weight-bolder opacity-7">
                                        발생 일시</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if(defectsData.length !=0 ){ %>
                                    <% for(var i=0; i<( defectsData.length>=5 ? 5 : defectsData.length); i++){ %>
                                        <tr>
                                            <td>
                                                <div class="d-flex px-2 py-1">
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <p class=" text-secondary mb-0">
                                                            <%= defectsData[i].module_id %>
                                                        </p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                <p class="font-weight-bold mb-0">
                                                    <%= defectsData[i].type %>
                                                </p>
                                            </td>
                                            <td class="align-middle text-center">
                                                <p class="font-weight-bold mb-0">
                                                    <%= moment(defectsData[i].occur_time).format('YYYY-MM-DD hh:mm:ss')
                                                        %>
                                                </p>
                                            </td>
                                        </tr>
                                        <%}} else{%>
                                            <tr>
                                                <td colspan="3" style="text-align: center;">내역이 없습니다.</td>
                                            </tr>
                                            <% }%>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-3">
        <div class="col-lg-3 mb-lg-0 mb-3">
            <div class="card z-index-2  h-100">
                <div class="card-header pb-0">
                    <h5>적재 현황</h5>
                </div>
                <div class="card-body p-3">
                    <div class="storage_status">
                        <img src="/image/storage43.png" class="img storage_default_img"></img>
                        <div class="row storage_good">
                            <% for(var i=1; i<4; i++){ %>
                                <img src="/image/new_work_4.png" class='<%="storage_work storage_work_"+  i %>'></img>
                                <%} %>
                        </div>
                        <div class="row storage_defects">
                            <% for(var i=1; i<4; i++){ %>
                                <img src="/image/new_work_4.png" class='<%="storage_work storage_work_"+  i %>'></img>
                                <%} %>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="col-lg-3 mb-lg-0 mb-3">
            <div class="card z-index-2 h-100">
                <div class="card-header pb-0">
                    <div class="row">
                        <div class="col-lg-6 col-7">
                            <h5>CCTV</h5>
                        </div>
                        <div class="col-lg-6 col-5 my-auto text-end"><span style="cursor: pointer;"
                                onclick="openPopupCCTV();">크게 보기</span>
                        </div>

                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="storage_status">
                        <canvas style="width: 100%;"></canvas>
                        <!-- <img src="/image/view2.jpg" class="img storage_default_img" style="width: 100%;"></img> -->
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-lg-0 mb-3">
            <div class="card z-index-2  h-100">
                <div class="card-header pb-0">
                    <div class="row">
                        <div class="col-lg-6 col-7">
                            <h5>생산 내역</h5>
                        </div>
                        <div class="col-lg-6 col-5 my-auto text-end"><span style="cursor: pointer;"
                                onclick="location.href='/production/list'">자세히</span></div>
                    </div>
                </div>
                <div class="card-body p-3">
                    <div class="table-responsive p-0">
                        <table class="table align-items-center mb-0">
                            <thead>
                                <tr>
                                    <th class="text-uppercase text-secondary font-weight-bolder opacity-7">
                                        모듈 번호</th>
                                    <th class="text-uppercase text-secondary font-weight-bolder opacity-7 ps-2">
                                        모듈 코드</th>
                                    <th class="text-center text-uppercase text-secondary font-weight-bolder opacity-7">
                                        용접 상태</th>
                                    <th class="text-center text-uppercase text-secondary font-weight-bolder opacity-7">
                                        전압</th>
                                    <th class="text-center text-uppercase text-secondary font-weight-bolder opacity-7">
                                        생산 일시</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% if(prodData.length !=0 ){ %>
                                    <% for(var i=0; i<( prodData.length>=3 ? 3 : prodData.length); i++){ %>
                                        <tr>
                                            <td>
                                                <div class="d-flex px-2 py-1">
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <p class=" text-secondary mb-0">
                                                            <%= prodData[i].module_id %>
                                                        </p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                <p class="font-weight-bold mb-0">
                                                    <%= prodData[i].module_type_id %>
                                                </p>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                <p class="font-weight-bold mb-0">
                                                    <%= prodData[i].defects==0 ? '양호' : '불량' ; %>
                                                </p>
                                            </td>
                                            <td class="align-middle text-center text-sm">
                                                <p class="font-weight-bold mb-0">
                                                    <%= prodData[i].voltage %>
                                                </p>
                                            </td>

                                            <td class="align-middle text-center">
                                                <p class="font-weight-bold mb-0">
                                                    <%= moment(prodData[i].finish_time).format('YYYY-MM-DD hh:mm:ss') %>
                                                </p>
                                            </td>
                                        </tr>
                                        <%}} else{%>
                                            <tr>
                                                <td colspan="5" style="text-align: center;">내역이 없습니다.</td>
                                            </tr>
                                            <% }%>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.bundle.min.js"></script>
<script type="text/javascript" charset="utf-8"
    src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script type="text/javascript"></script>

<script src="/js/mqttws31-min.js" defer></script>
<script src="/js/mqttws31.js" defer></script>
<script src="/js/mqtt.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsmpeg/0.1/jsmpg.js"></script>

<script src="/js/dashboard.js" defer></script>