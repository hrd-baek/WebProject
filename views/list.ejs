<div class="container-fluid">
    <h4 class="mt-2"></h4>
    <div class="row">
        <div class="col-12">
            <div class="card mb-4">
                <div class="card-body dashboard-card-body">
                    <div class="row mb-3">
                        <div class="col-xl-2"> </div>
                        <div class="col-xl-2" style="text-align: center;">
                            <input id="select_date" class="form-control select_date" />
                        </div>
                        <div class="col-xl-1 select-col" style="text-align: center;">
                            <select class="form-select search-select" id="search-select">
                                <option value="1" selected>모듈 번호</option>
                                <option value="2">모듈 이름</option>
                            </select>
                        </div>
                        <div class="col-xl-4" style="text-align: center;">
                            <div class="table_search">
                                <input type="text" placeholder="검색어 입력" id="search-input" onkeyup="enterkey()">
                                <img src="https://s3.ap-northeast-2.amazonaws.com/cdn.wecode.co.kr/icon/search.png"
                                    onclick="tableSearch()" id="search-btn">
                            </div>
                        </div>
                    </div>
                    <table id="production_list_table" class="display nowrap custom_table_2" style="width:100%">
                        <thead>
                            <tr>
                                <th>모듈 번호</th>
                                <th>모듈 이름</th>
                                <th>Cell 정보</th>
                                <th>용접 상태</th>
                                <th>전압 </th>
                                <th>생산 시작 일시</th>
                                <th>생산 완료 일시</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for(var i=0; i<tableData.length; i++){ %>
                                <tr>
                                    <td>
                                        <%= tableData[i].module_id %>
                                    </td>

                                    <td>
                                        <%= tableData[i].module_type_id %>
                                    </td>

                                    <td>
                                        <!-- <span class="badge badge-sm bg-secondary" data-bs-toggle="modal"
                                            data-bs-target="#staticBackdrop" style="cursor :pointer">Click</span> -->
                                        <span class="badge badge-sm bg-secondary" onclick="getCellData(this)"
                                            style="cursor :pointer">Click</span>
                                    </td>

                                    <td>
                                        <%= tableData[i].defects==0? '양호' : '불량' %>
                                    </td>

                                    <td>
                                        <%= tableData[i].voltage %> V
                                    </td>

                                    <td>
                                        <%= tableData[i].start_time %>
                                    </td>
                                    <td>
                                        <%= tableData[i].finish_time %>
                                    </td>
                                </tr>
                                <%} %>
                        </tbody>
                    </table>
                </div>
            </div>


        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="staticBackdropLabel">Cell 정보</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    모듈 ~~에 포함된 셀은 ~~ 입니다.
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">확인</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- <script src="/js/table.js" defer></script> -->
<script src="/js/list.js" defer></script>
<script>
    function getCellData(element) {
        var row = element.closest('tr');
        var moduleID = row.querySelector('td:first-child').innerText;

        $.ajax({
            url: "/production/list/cell",
            type: "POST",
            async: false,
            dataType: "json",
            data: { moduleId: moduleID },
            success: function (res) {
                $('#staticBackdrop').modal('show');

                var str = "";
                for (var i = 0; i < res.length; i++) {
                    str += res[i].stacking_id;
                }
                $('#staticBackdrop .modal-body').html(str);
            },
            error: function (xhr) {
                alert(xhr);
            }
        });
    }
</script>